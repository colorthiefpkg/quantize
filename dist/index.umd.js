!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.quantize=r()}(this,function(){if(!t)var t={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,i){return n.index=i,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(r,n){return Math.max.apply(null,n?t.map(r,n):r)}};return function(){var r=5,n=8-r,o=1e3;function i(t,n,o){return(t<<2*r)+(n<<r)+o}function e(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function u(t,r,n,o,i,e,u){this.r1=t,this.r2=r,this.g1=n,this.g2=o,this.b1=i,this.b2=e,this.histo=u}function s(){this.vboxes=new e(function(r,n){return t.naturalOrder(r.vbox.count()*r.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function f(r,n){if(n.count()){var o=n.r2-n.r1+1,e=n.g2-n.g1+1,u=t.max([o,e,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var s,f,h,c,a=0,v=[],p=[];if(u==o)for(s=n.r1;s<=n.r2;s++){for(c=0,f=n.g1;f<=n.g2;f++)for(h=n.b1;h<=n.b2;h++)c+=r[i(s,f,h)]||0;v[s]=a+=c}else if(u==e)for(s=n.g1;s<=n.g2;s++){for(c=0,f=n.r1;f<=n.r2;f++)for(h=n.b1;h<=n.b2;h++)c+=r[i(f,s,h)]||0;v[s]=a+=c}else for(s=n.b1;s<=n.b2;s++){for(c=0,f=n.r1;f<=n.r2;f++)for(h=n.g1;h<=n.g2;h++)c+=r[i(f,h,s)]||0;v[s]=a+=c}return v.forEach(function(t,r){p[r]=a-t}),function(t){var r,o,i,e,u,f=t+"1",h=t+"2",c=0;for(s=n[f];s<=n[h];s++)if(v[s]>a/2){for(i=n.copy(),e=n.copy(),u=(r=s-n[f])<=(o=n[h]-s)?Math.min(n[h]-1,~~(s+o/2)):Math.max(n[f],~~(s-1-r/2));!v[u];)u++;for(c=p[u];!c&&v[u-1];)c=p[--u];return i[h]=u,e[f]=i[h]+1,[i,e]}}(u==o?"r":u==e?"g":"b")}}return u.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var r=this.histo;if(!this._count_set||t){var n,o,e,u=0;for(n=this.r1;n<=this.r2;n++)for(o=this.g1;o<=this.g2;o++)for(e=this.b1;e<=this.b2;e++)u+=r[i(n,o,e)]||0;this._count=u,this._count_set=!0}return this._count},copy:function(){return new u(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var n=this.histo;if(!this._avg||t){var o,e,u,s,f=0,h=1<<8-r,c=0,a=0,v=0;for(e=this.r1;e<=this.r2;e++)for(u=this.g1;u<=this.g2;u++)for(s=this.b1;s<=this.b2;s++)f+=o=n[i(e,u,s)]||0,c+=o*(e+.5)*h,a+=o*(u+.5)*h,v+=o*(s+.5)*h;this._avg=f?[~~(c/f),~~(a/f),~~(v/f)]:[~~(h*(this.r1+this.r2+1)/2),~~(h*(this.g1+this.g2+1)/2),~~(h*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var r=t[0]>>n;return gval=t[1]>>n,bval=t[2]>>n,r>=this.r1&&r<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},s.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,i=this.vboxes,e=0;e<i.size();e++)((n=Math.sqrt(Math.pow(t[0]-i.peek(e).color[0],2)+Math.pow(t[1]-i.peek(e).color[1],2)+Math.pow(t[2]-i.peek(e).color[2],2)))<r||void 0===r)&&(r=n,o=i.peek(e).color);return o},forcebw:function(){var r=this.vboxes;r.sort(function(r,n){return t.naturalOrder(t.sum(r.color),t.sum(n.color))});var n=r[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(r[0].color=[0,0,0]);var o=r.length-1,i=r[o].color;i[0]>251&&i[1]>251&&i[2]>251&&(r[o].color=[255,255,255])}},{quantize:function(h,c){if(!h.length||c<2||c>256)return!1;var a=function(t){var o,e=new Array(1<<3*r);return t.forEach(function(t){o=i(t[0]>>n,t[1]>>n,t[2]>>n),e[o]=(e[o]||0)+1}),e}(h);a.forEach(function(){});var v=function(t,r){var o,i,e,s=1e6,f=0,h=1e6,c=0,a=1e6,v=0;return t.forEach(function(t){(o=t[0]>>n)<s?s=o:o>f&&(f=o),(i=t[1]>>n)<h?h=i:i>c&&(c=i),(e=t[2]>>n)<a?a=e:e>v&&(v=e)}),new u(s,f,h,c,a,v,r)}(h,a),p=new e(function(r,n){return t.naturalOrder(r.count(),n.count())});function l(t,r){for(var n,i=t.size(),e=0;e<o;){if(i>=r)return;if(e++>o)return;if((n=t.pop()).count()){var u=f(a,n),s=u[0],h=u[1];if(!s)return;t.push(s),h&&(t.push(h),i++)}else t.push(n),e++}}p.push(v),l(p,.75*c);for(var b=new e(function(r,n){return t.naturalOrder(r.count()*r.volume(),n.count()*n.volume())});p.size();)b.push(p.pop());l(b,c);for(var g=new s;b.size();)g.push(b.pop());return g}}}().quantize});
//# sourceMappingURL=index.umd.js.map
