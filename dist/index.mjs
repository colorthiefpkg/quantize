if(!t)var t={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,i){return n.index=i,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(r,n){return Math.max.apply(null,n?t.map(r,n):r)}};export default function(){var r=5,n=8-r,o=1e3;function i(t,n,o){return(t<<2*r)+(n<<r)+o}function u(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function e(t,r,n,o,i,u,e){this.r1=t,this.r2=r,this.g1=n,this.g2=o,this.b1=i,this.b2=u,this.histo=e}function s(){this.vboxes=new u(function(r,n){return t.naturalOrder(r.vbox.count()*r.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function h(r,n){if(n.count()){var o=n.r2-n.r1+1,u=n.g2-n.g1+1,e=t.max([o,u,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var s,h,f,c,a=0,v=[],l=[];if(e==o)for(s=n.r1;s<=n.r2;s++){for(c=0,h=n.g1;h<=n.g2;h++)for(f=n.b1;f<=n.b2;f++)c+=r[i(s,h,f)]||0;v[s]=a+=c}else if(e==u)for(s=n.g1;s<=n.g2;s++){for(c=0,h=n.r1;h<=n.r2;h++)for(f=n.b1;f<=n.b2;f++)c+=r[i(h,s,f)]||0;v[s]=a+=c}else for(s=n.b1;s<=n.b2;s++){for(c=0,h=n.r1;h<=n.r2;h++)for(f=n.g1;f<=n.g2;f++)c+=r[i(h,f,s)]||0;v[s]=a+=c}return v.forEach(function(t,r){l[r]=a-t}),function(t){var r,o,i,u,e,h=t+"1",f=t+"2",c=0;for(s=n[h];s<=n[f];s++)if(v[s]>a/2){for(i=n.copy(),u=n.copy(),e=(r=s-n[h])<=(o=n[f]-s)?Math.min(n[f]-1,~~(s+o/2)):Math.max(n[h],~~(s-1-r/2));!v[e];)e++;for(c=l[e];!c&&v[e-1];)c=l[--e];return i[f]=e,u[h]=i[f]+1,[i,u]}}(e==o?"r":e==u?"g":"b")}}return e.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var r=this.histo;if(!this._count_set||t){var n,o,u,e=0;for(n=this.r1;n<=this.r2;n++)for(o=this.g1;o<=this.g2;o++)for(u=this.b1;u<=this.b2;u++)e+=r[i(n,o,u)]||0;this._count=e,this._count_set=!0}return this._count},copy:function(){return new e(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var n=this.histo;if(!this._avg||t){var o,u,e,s,h=0,f=1<<8-r,c=0,a=0,v=0;for(u=this.r1;u<=this.r2;u++)for(e=this.g1;e<=this.g2;e++)for(s=this.b1;s<=this.b2;s++)h+=o=n[i(u,e,s)]||0,c+=o*(u+.5)*f,a+=o*(e+.5)*f,v+=o*(s+.5)*f;this._avg=h?[~~(c/h),~~(a/h),~~(v/h)]:[~~(f*(this.r1+this.r2+1)/2),~~(f*(this.g1+this.g2+1)/2),~~(f*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var r=t[0]>>n;return gval=t[1]>>n,bval=t[2]>>n,r>=this.r1&&r<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},s.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,i=this.vboxes,u=0;u<i.size();u++)((n=Math.sqrt(Math.pow(t[0]-i.peek(u).color[0],2)+Math.pow(t[1]-i.peek(u).color[1],2)+Math.pow(t[2]-i.peek(u).color[2],2)))<r||void 0===r)&&(r=n,o=i.peek(u).color);return o},forcebw:function(){var r=this.vboxes;r.sort(function(r,n){return t.naturalOrder(t.sum(r.color),t.sum(n.color))});var n=r[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(r[0].color=[0,0,0]);var o=r.length-1,i=r[o].color;i[0]>251&&i[1]>251&&i[2]>251&&(r[o].color=[255,255,255])}},{quantize:function(f,c){if(!f.length||c<2||c>256)return!1;var a=function(t){var o,u=new Array(1<<3*r);return t.forEach(function(t){o=i(t[0]>>n,t[1]>>n,t[2]>>n),u[o]=(u[o]||0)+1}),u}(f);a.forEach(function(){});var v=function(t,r){var o,i,u,s=1e6,h=0,f=1e6,c=0,a=1e6,v=0;return t.forEach(function(t){(o=t[0]>>n)<s?s=o:o>h&&(h=o),(i=t[1]>>n)<f?f=i:i>c&&(c=i),(u=t[2]>>n)<a?a=u:u>v&&(v=u)}),new e(s,h,f,c,a,v,r)}(f,a),l=new u(function(r,n){return t.naturalOrder(r.count(),n.count())});function p(t,r){for(var n,i=t.size(),u=0;u<o;){if(i>=r)return;if(u++>o)return;if((n=t.pop()).count()){var e=h(a,n),s=e[0],f=e[1];if(!s)return;t.push(s),f&&(t.push(f),i++)}else t.push(n),u++}}l.push(v),p(l,.75*c);for(var b=new u(function(r,n){return t.naturalOrder(r.count()*r.volume(),n.count()*n.volume())});l.size();)b.push(l.pop());p(b,c);for(var g=new s;b.size();)g.push(b.pop());return g}}}().quantize;
//# sourceMappingURL=index.mjs.map
